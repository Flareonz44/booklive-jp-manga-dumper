function md_setup_msg(){let e=document.createElement("div");return e.style.position="fixed",e.style.top="10px",e.style.right="10px",e.style.padding="10px",e.style.color="white",e.style.borderRadius="5px",e.style.zIndex="10000",e.style.display="none",e.style.textAlign="center",e.style.fontFamily="monospace",e.style.backgroundImage='url("https://i.imgur.com/vSZhlRk.png")',e.style.backgroundSize="cover",e.style.backgroundPosition="center center",e.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.5)",document.body.appendChild(e),e}function md_setup_keymgr(){document.onkeypress=function(e){e=(e=e||window.event).keyCode||e.which,e=String.fromCharCode(e);"1"!=e||scanning?"9"!=e||scanning?"2"==e&&scanning?download_request=!0:"3"==e&&enable_download?(enable_download=!1,md_download_images(manga_dumped)):"4"==e&&enable_download&&(enable_download=!1,md_zip_images(manga_dumped)):(dump_checks=5,md_scan(Object.keys(manga_dumped)),scanning=!0):(dump_checks=2,md_scan(Object.keys(manga_dumped)),scanning=!0)}}function md_show_message(e,n=!1){var t="\n\n<small><a href='https://github.com/Flareonz44/booklive-jp-manga-dumper?tab=readme-ov-file#booklivejp-manga-dumper' target='_blank' rel='noopener noreferrer' style='color: aqua;'>Check the README file</a></small>\n";msg_buid="<b>$$$$ BookLiveJP Manga Dumper v1.8 $$$$</b>\n________________________ by <a href='https://linktr.ee/flareonz44' target='_blank' rel='noopener noreferrer' style='color: fuchsia;text-decoration: unset;'>Flareonz44</a>\n\n",n?(0<e.length&&(e="\n\n"+e),msg_buid+="Scan finished, "+Object.keys(manga_dumped).length.toString()+" pages saved\n\n>> Press 3 to save all png's <<\n>> Press 4 to download as .zip <<\n>> Use <b>get_pages()</b> <<"+e+t):msg_buid+=e+t,msg_obj.innerHTML=msg_buid.toString().replaceAll("\n","<br>"),msg_obj.style.display="block"}function md_download_images(t){md_show_message("Downloading images...",!0),Object.keys(t).forEach(e=>{const n=document.createElement("a");n.href=t[e].data,n.download=document.title+" - "+e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}),md_show_message("",enable_download=!0)}function md_merge_blobs(e){const n=document.createElement("canvas"),t=n.getContext("2d");let a=[];e.forEach(e=>{let n=new Image;n.src=e,a.push(n)}),n.width=a[0].width,n.height=0,a.forEach(e=>{n.height+=e.height});let o=0;return a.forEach(e=>{t.drawImage(e,0,o,e.width,e.height),o+=e.height}),n.toDataURL()}function get_pages(e){e.forEach(n=>{if(Object.keys(manga_dumped).includes(n)){console.log("Downloading "+n+"...");let e={};e[n]=manga_dumped[n],md_download_images(e)}else console.log("Page "+n.toString()+" not saved!")})}function md_zip_images(a){md_show_message("Generating zip...",!0);let e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js",e.onload=()=>{const t=new JSZip;Object.keys(a).forEach(e=>{var n=a[e].data.split(",")[1];t.file(e,n,{base64:!0})}),t.generateAsync({type:"blob"}).then(function(e){md_show_message("Downloading zip...",!0);const n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=document.title+".zip",document.body.appendChild(n),n.click(),document.body.removeChild(n),md_show_message("",enable_download=!0)})},document.head.appendChild(e)}function md_scan(t){md_show_message((2<dump_checks?"Hard":"Lite")+" scanning, "+t.length.toString()+" pages discovered\n\n>> Press 2 to finish scan <<");var e=document.querySelector("#content");let n=Array.from(e.children);dump={},n.forEach(e=>{if(e.hasChildNodes()&&e.id.startsWith("content-")&&(keyn=e.id.replace("content-","")+".png",!(t.includes(keyn)&&manga_dumped[keyn].count>=dump_checks))){let n=[];e.querySelectorAll("img").forEach(e=>{n.push(e.currentSrc)}),3==n.length&&((e={data:md_merge_blobs(n),count:t.includes(keyn)?manga_dumped[keyn].count+1:1}).data.length<500||(dump[keyn]=e))}}),manga_dumped={...manga_dumped,...dump},download_request?(md_show_message("",!0),enable_download=!0):setTimeout(()=>md_scan(Object.keys(manga_dumped)),300)}let manga_dumped={},scanning=!1,download_request=!1,enable_download=!1,dump_checks=2;msg_obj=md_setup_msg(),md_setup_keymgr(),md_show_message(">> Press 1 to start <b>lite</b> scan <<\n>> Press 9 to start <b>hard</b> scan <<");
